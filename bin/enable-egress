#!/bin/bash
set -e
set -o pipefail

help()
{
    echo
    echo "$0: enables egress proxy for a given app."
    echo "Note that this will not set up egress, but rather re-enable egress that has been disabled with disable-egress."
    echo "Syntax: $0 <APP>"
    echo "  <APP> must be a valid cf app in the current space with egress disabled."
    #echo "Options:"
    #echo "  --space <SPACE>: #TODO"
    echo
    echo "To disable egress for an app, use disable-egress."
    echo "This depends on DATAGOV_DIR and CG_DIR environment variables being set."
    exit 1
}

app="$1"
space="$2"
#startspace=$( cf target | grep space: | awk --field-separator ' ' '{ print $2 }')

if [ -z "$app" ]; then
    echo "No app provided."
    help
elif [ -z "$space" ]; then
    echo "No app provided."
    help
else
    cp "$DATAGOV_DIR/egress/acl/${app}.allow.acl" "$CG_DIR"
    cp "$DATAGOV_DIR/egress/acl/${app}.deny.acl" "$CG_DIR"

    "$CG_DIR/bin/cf-deployproxy" "$app" "$space"
fi
